nextflow_pipeline {

    name "Test Workflow main.nf"
    script "../main.nf"
    options "-stub-run"

    test("Should run without failures, using stub") {

        when {
            params {
                run_id = "run1"
                run_dir = "${projectDir}/workflows/templates"
                indexPlate = "A"
                project_name = "project1"
                sample_type = "test_samples"
                plate_design_csv = "${projectDir}/test_data/plate_design.csv"
                reveal_fixed_lod_csv = "${projectDir}/test_data/reveal_fixed_lod.csv"
                dataAnalysisRefIds = "test3"
                panelDataArchive = "${projectDir}/test_data/panelDataArchive.dat"
                samplesheet = "${projectDir}/workflows/templates/samplesheet.csv"
            }
        }

        then {
            assert workflow.success
            assert path("$launchDir/results/bclconvert/output/Reports/SampleSheet.csv").exists()
            assert path("$launchDir/results/npx_qc_report/olink_reveal_QC_report.html").exists()
            assert path("$launchDir/results/npx_export/export_dir/test.parquet").exists()
        }

    }

}
